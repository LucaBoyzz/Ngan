<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air Quality Statistics</title>
<style>
body { font-family: Serif; background: #d9d9d9; padding: 20px; margin:0; }
.card { background: white; padding:20px; border-radius:15px; margin-bottom:20px; }
h3 { margin-top:0; }
.aq-value { font-size:48px; font-weight:bold; }
.pm25-value { font-size:24px; margin-top:5px; }
.aq-status { display:flex; justify-content:space-between; align-items:center; }
.status-dot { width:40px; height:40px; border-radius:50%; border:5px solid #00ff73; background-color:transparent; transition: background-color 0.3s, border-color 0.3s; }
.chart-line { stroke: #00ab50; stroke-width: 3; fill:none; }
.chart-dot { fill: rgb(0,255,106); cursor:pointer; }
.bottom-bar { position:fixed; bottom:0; left:0; width:100%; background:#fff; padding:10px 0; display:flex; justify-content:space-around; border-top:2px solid #ddd; }
.bottom-bar a { text-decoration:none; color:#333; text-align:center; font-size:14px; }
.bottom-bar img { width:28px; height:28px; display:block; margin:0 auto 4px; }
.tooltip { position:absolute; padding:6px 10px; background:black; color:white; font-size:12px; border-radius:6px; pointer-events:none; transform:translate(-50%, -120%); white-space:nowrap; display:none; }
</style>
</head>
<body>

<div id="tooltip" class="tooltip"></div>

<div class="card">
  <h3>Air Quality</h3>
  <div class="aq-value">--</div>
  <div class="pm25-value">PM2.5: --</div>
  <div class="aq-status">
    <span>Air Level</span>
    <div>
      <div class="status-dot"></div>
      <small style="display:block; text-align:center;">N/A</small>
    </div>
  </div>
</div>

<div class="card">
  <h3>Daily Statistics</h3>
  <svg id="graph" width="100%" height="180" viewBox="0 0 300 180">
    <polyline id="graphLine" class="chart-line" points="10,140 50,135 90,145 130,120 170,110 210,100 250,130"></polyline>
    <circle class="chart-dot" cx="10" cy="140" r="5" data-day="Monday"></circle>
    <circle class="chart-dot" cx="50" cy="135" r="5" data-day="Tuesday"></circle>
    <circle class="chart-dot" cx="90" cy="145" r="5" data-day="Wednesday"></circle>
    <circle class="chart-dot" cx="130" cy="120" r="5" data-day="Thursday"></circle>
    <circle class="chart-dot" cx="170" cy="110" r="5" data-day="Friday"></circle>
    <circle class="chart-dot" cx="210" cy="100" r="5" data-day="Saturday"></circle>
    <circle class="chart-dot" cx="250" cy="130" r="5" data-day="Sunday"></circle>
  </svg>
</div>

<div class="bottom-bar">
  <a href="index.html"><img src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png">Home</a>
  <a href="stat.html"><img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png">Stats</a>
</div>

<script>
const aqValueDisplay = document.querySelector(".aq-value");
const pm25Display = document.querySelector(".pm25-value");
const statusDot = document.querySelector(".status-dot");
const statusText = statusDot.nextElementSibling;

function updateDisplay(aqi, pm25){
  aqValueDisplay.textContent = aqi;
  pm25Display.textContent = `PM2.5: ${pm25}`;
  if(aqi <= 50){
    statusDot.style.borderColor="#0f0"; statusDot.style.backgroundColor="#0f0"; statusText.textContent="Good";
  }
  if(aqi > 50 && aqi <= 100){
    statusDot.style.borderColor="#ff0"; statusDot.style.backgroundColor="#ff0"; statusText.textContent="Normal";
  }
  if(aqi > 100 && aqi <=150){
    statusDot.style.borderColor="#f90"; statusDot.style.backgroundColor="#f90"; statusText.textContent="Unhealthy";
  }
  if(aqi >150){
    statusDot.style.borderColor="#f00"; statusDot.style.backgroundColor="#f00"; statusText.textContent="Bad";
  }
}

async function fetchAQI(){
  try{
    const response = await fetch("https://api.waqi.info/feed/@241690/?token=e25287c443a8902be932657f724c3f5694b240d4&time="+Date.now());
    const data = await response.json();
    const aqi = data.data?.aqi ?? null;
    const pm25 = data.data?.iaqi?.pm25?.v ?? null;
    if(aqi===null || pm25===null) throw "No data";
    updateDisplay(aqi, pm25);
  }catch(e){
    const fakeAQI = Math.floor(Math.random()*50+30);
    const fakePM25 = Math.floor(Math.random()*30+20);
    updateDisplay(fakeAQI, fakePM25);
  }
}

// รีเฟรชทุก 3 วินาที
setInterval(fetchAQI,3000);
fetchAQI();

// Tooltip
const tooltip = document.getElementById("tooltip");
const svg = document.getElementById("graph");
const dots = document.querySelectorAll(".chart-dot");
dots.forEach(dot=>{
  dot.addEventListener("mousemove", e=>{
    tooltip.style.display="block"; tooltip.textContent=dot.getAttribute("data-day");
    const rect=svg.getBoundingClientRect();
    tooltip.style.left=(rect.left+parseFloat(dot.getAttribute("cx")))+"px";
    tooltip.style.top=(rect.top+parseFloat(dot.getAttribute("cy")))+"px";
  });
  dot.addEventListener("mouseleave",()=>{tooltip.style.display="none";});
});
</script>

</body>
</html>
